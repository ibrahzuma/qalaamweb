{% extends 'base.html' %}

{% block title %}Holy Quran - QALAAM{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="row mb-4">
    <div class="col-12 text-center py-5"
        style="background: linear-gradient(135deg, #004d40 0%, #1a237e 100%); border-radius: 20px; color: white; position: relative; overflow: hidden;">
        <div style="position: absolute; top: -10%; right: -5%; opacity: 0.1;">
            <i class="bi bi-moon-stars" style="font-size: 15rem;"></i>
        </div>
        <h1 class="display-3 fw-bold" style="color: #ffd700;">The Holy Quran</h1>
        <p class="lead opacity-75">Listen to soul-stirring recitations from around the world</p>
    </div>
</div>

<!-- Reciter & Search Navigation -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card border-0 shadow-sm rounded-4 p-4" style="border-top: 5px solid #ffd700 !important;">
            <form method="GET" class="row g-3 align-items-center">
                <div class="col-md-5">
                    <div class="input-group">
                        <span class="input-group-text bg-transparent border-end-0"><i
                                class="bi bi-search text-muted"></i></span>
                        <input type="text" name="q" class="form-control border-start-0" placeholder="Search Surah..."
                            value="{{ query|default:'' }}">
                    </div>
                </div>
                <div class="col-md-5">
                    <select name="reciter" class="form-select" onchange="this.form.submit()">
                        <option value="">All Reciters</option>
                        {% for r in reciters %}
                        <option value="{{ r.slug }}" {% if r.slug == current_reciter %}selected{% endif %}>{{ r.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-dark w-100 rounded-pill">Search</button>
                </div>
            </form>

            <!-- Reciter Pills -->
            <div class="mt-4">
                <h6 class="text-uppercase fw-bold small text-muted mb-3"><i class="bi bi-people me-2"></i> Featured
                    Reciters</h6>
                <div class="d-flex flex-wrap gap-2">
                    <a href="{% url 'content:quran_list' %}"
                        class="btn btn-sm {% if not current_reciter %}btn-warning text-dark{% else %}btn-outline-secondary{% endif %} rounded-pill px-3 fw-bold">All</a>
                    {% for r in reciters %}
                    <a href="?reciter={{ r.slug }}{% if query %}&q={{ query }}{% endif %}"
                        class="btn btn-sm {% if current_reciter == r.slug %}btn-warning text-dark{% else %}btn-outline-secondary{% endif %} rounded-pill px-3 fw-bold">
                        {{ r.name }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Surah Grid -->
<div class="row g-4">
    {% for surah in surahs %}
    <div class="col-md-6 col-lg-4">
        <div class="card h-100 border-0 shadow-sm rounded-4 surah-card p-2">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="bg-success bg-opacity-10 p-3 rounded-4">
                        <i class="bi bi-music-note-beamed text-success fs-4"></i>
                    </div>
                    <span class="badge bg-light text-dark rounded-pill">{{ surah.category.name }}</span>
                </div>

                <h5 class="fw-bold mb-1">{{ surah.title }}</h5>
                <p class="text-muted small mb-4"><i class="bi bi-person-fill"></i> {{ surah.speaker }}</p>

                <div class="surah-player p-2 rounded-3 bg-light mb-3">
                    <audio controls class="w-100" style="height: 35px;">
                        <source src="{{ surah.file.url }}" type="audio/mpeg">
                    </audio>
                </div>

                <div class="d-flex gap-2">
                    <a href="{{ surah.file.url }}" download
                        class="btn btn-sm btn-outline-success flex-grow-1 rounded-pill">
                        <i class="bi bi-download me-1"></i> Download
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
        <div class="opacity-25 mb-3">
            <i class="bi bi-music-note-list display-1" style="color: #004d40;"></i>
        </div>
        <h3 class="fw-bold">No recitations found</h3>
        <p class="text-muted">Try choosing a different reciter or surah.</p>
        <a href="{% url 'content:quran_list' %}" class="btn btn-success rounded-pill px-4">See All Surahs</a>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if is_paginated %}
<div class="row mt-5">
    <div class="col-12">
        <nav>
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link rounded-circle mx-1"
                        href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if current_reciter %}&reciter={{ current_reciter }}{% endif %}">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>
                {% endif %}
                <li class="page-item active"><span class="page-link rounded-circle mx-1"
                        style="background-color: #004d40;">{{ page_obj.number }}</span></li>
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link rounded-circle mx-1"
                        href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if current_reciter %}&reciter={{ current_reciter }}{% endif %}">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>
{% endif %}

<style>
    .surah-card {
        transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
        border: 1px solid rgba(0, 0, 0, 0.05) !important;
    }

    .surah-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 1rem 3rem rgba(0, 77, 64, 0.1) !important;
        border-color: #004d40 !important;
    }

    .page-link {
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #004d40;
        border: none;
        background: #fff;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .page-item.active .page-link {
        background-color: #004d40;
        color: #ffd700;
    }
</style>
{% endblock %}
